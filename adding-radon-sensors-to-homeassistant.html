<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Adding Radon Sensors to Home Assistant | Stanley Solutions Blog
</title>
  <link rel="canonical" href="https://blog.stanleysolutionsnw.com/adding-radon-sensors-to-homeassistant.html">


  <link rel="stylesheet" href="https://bootswatch.com/4/darkly/bootstrap.css">
  <link rel="stylesheet" href="https://blog.stanleysolutionsnw.com/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="https://blog.stanleysolutionsnw.com/theme/css/pygments/monokai.min.css">
  <link rel="stylesheet" href="https://blog.stanleysolutionsnw.com/theme/css/theme.css">
  <link rel="stylesheet" href="https://blog.stanleysolutionsnw.com/custom.css">
  <link rel="stylesheet" href="https://files.stork-search.net/dark.css">
  <script src="https://files.stork-search.net/releases/v1.6.0/stork.js"></script>

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://blog.stanleysolutionsnw.com/feeds/all.atom.xml">
  <link rel="alternate" type="application/rss+xml" title="Full RSS Feed"
        href="https://blog.stanleysolutionsnw.com/feeds/all.rss.xml">  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://blog.stanleysolutionsnw.com/feeds/home-improvement.atom.xml">  <link rel="alternate" type="application/rss+xml" title="Categories RSS Feed"
        href="https://blog.stanleysolutionsnw.com/feeds/home-improvement.rss.xml">  
  <meta name="description" content="Radon - an colorless, oderless gas. Sounds familiar, right? But you've probably heard that phrase in relation to other gasses like the carbon-monoxide, or perhaps natural gas. Radon poses health threats, as well, but with the added benefit of radiation. Scared yet? Don't worry.">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="https://blog.stanleysolutionsnw.com/">
        <img class="img-fluid rounded" src=https://blog.stanleysolutionsnw.com/logo.png alt="Stanley Solutions Blog">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="https://blog.stanleysolutionsnw.com/">Stanley Solutions Blog</a></h1>
      <p class="text-muted">engineering and creativity - all under one hat</p>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="https://stanleysolutionsnw.com" target="_blank">Stanley Solutions Website</a></li>
          <li class="list-inline-item"><a href="https://electricpy.readthedocs.io/en/latest/" target="_blank">ElectricPy</a></li>
          <li class="list-inline-item"><a href="https://engineerjoe440.github.io/selprotopy" target="_blank">SELProtoPy</a></li>
          <li class="list-inline-item"><a href="https://engineerjoe440.github.io/pycev" target="_blank">PyCEV</a></li>
          <li class="list-inline-item"><a href="https://gitlab.stanleysolutionsnw.com/krnc/usb-manager" target="_blank">KRNC Barn Manager</a></li>
          <li class="list-inline-item"><a href="https://github.com/engineerjoe440/schemdraw-markdown" target="_blank">Schemdraw-Markdown</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fas fa-comments" href="https://matrix.to/#/@engineerjoe440:stanleysolutionsnw.com" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-github" href="https://github.com/engineerjoe440/" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fab fa-gitlab" href="https://gitlab.stanleysolutionsnw.com/engineerjoe440" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-coffee" href="https://gitea.stanleysolutionsnw.com/engineerjoe440" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-calendar" href="https://calendar.google.com/calendar/embed?src=engineerjoe440%40gmail.com&ctz=America%2FLos_Angeles" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fas fa-rss" href="https://blog.stanleysolutionsnw.com/feeds/all.rss.xml" target="_blank"></a></li>
      </ul>
    <div class="stork-wrapper-dark">
      <input data-stork="sitesearch" class="stork-input" placeholder="search"/>
      <div data-stork="sitesearch-output" class="stork-output"></div>
    </div>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Adding Radon Sensors to Home Assistant
</h1>
      <hr>
  <main>
    <article class="article">
      <header>
        <ul class="list-inline">
          <li class="list-inline-item text-muted" title="2022-12-24T10:40:00-08:00">
            <i class="fas fa-clock"></i>
            Sat 24 December 2022
          </li>
          <li class="list-inline-item">
            <i class="fas fa-folder-open"></i>
            <a href="https://blog.stanleysolutionsnw.com/category/home-improvement.html">Home-Improvement</a>
          </li>
            <li class="list-inline-item">
              <i class="fas fa-user"></i>
                <a href="https://blog.stanleysolutionsnw.com/author/joe-stanley.html">Joe Stanley</a>            </li>
            <li class="list-inline-item">
              <i class="fas fa-tag"></i>
                <a href="https://blog.stanleysolutionsnw.com/tag/homeassistant.html">#homeassistant</a>,                 <a href="https://blog.stanleysolutionsnw.com/tag/home-assistant.html">#home-assistant</a>,                 <a href="https://blog.stanleysolutionsnw.com/tag/hasio.html">#hasio</a>,                 <a href="https://blog.stanleysolutionsnw.com/tag/airthings.html">#airthings</a>,                 <a href="https://blog.stanleysolutionsnw.com/tag/ble.html">#ble</a>,                 <a href="https://blog.stanleysolutionsnw.com/tag/bluetooth.html">#bluetooth</a>,                 <a href="https://blog.stanleysolutionsnw.com/tag/wireless.html">#wireless</a>,                 <a href="https://blog.stanleysolutionsnw.com/tag/radon.html">#radon</a>,                 <a href="https://blog.stanleysolutionsnw.com/tag/air.html">#air</a>,                 <a href="https://blog.stanleysolutionsnw.com/tag/quality.html">#quality</a>            </li>
        </ul>
      </header>
      <div class="content">
        <h2>What is Radon, Anyway?</h2>
<p>The <a href="https://www.cdc.gov/nceh/features/protect-home-radon/index.html">CDC</a> explains that Radon is:</p>
<blockquote>
<p>" ...the second leading cause of lung cancer after cigarette smoking. If you smoke and live in a home with high radon levels, you increase your risk of developing lung cancer. Having your home tested is the only effective way to determine whether you and your family are at risk of high radon exposure.</p>
<p>Radon is a radioactive gas that forms naturally when uranium, thorium, or radium, which are radioactive metals break down in rocks, soil and groundwater. People can be exposed to radon primarily from breathing radon in air that comes through cracks and gaps in buildings and homes. Because radon comes naturally from the earth, people are always exposed to it. "</p>
</blockquote>
<p>Luckily for me, I don't smoke. So some of that problem is a non-starter. Buuuut... Have you
seen <a href="https://blog.stanleysolutionsnw.com/more-servers-in-the-basement.html">my basement</a>?
Yeah... that's where this all comes from. And the photos in that post don't even capture the
wet season.</p>
<p>Hah!</p>
<h2>What can be done?</h2>
<p>The <a href="https://www.cdc.gov/nceh/features/protect-home-radon/index.html">CDC</a> goes into some detail about some options which exist to support annual tests for
Radon, but there's also technology that can help; and, have you met me? Of course I want to use
the technology! That's the fun part.</p>
<p>Airthings is a pretty neat company. They offer a digital air-quality and Radon sensing solution,
and they even make their technology accessible <em>without</em> needing the cloud! For self-hosters like
me, that's pretty exciting. You can read more about
<a href="https://www.airthings.com/resources/radon-detection">what thoughts Airthings share regarding Radon detection methods on their website</a>.</p>
<h2>The Sensor</h2>
<p>Airthings' Wave Plus sensor is just what I needed. I picked one up last year from Amazon, but
you can see from <a href="https://shop.airthings.com/US_EN/wave-plus.html">Airthings' store</a> that these
things are a bit on the spendy side. Still not bad.</p>
<p><img src="https://shop.airthings.com/media/catalog/product/cache/2634002fa3d4cd41f308759bc7b7f687/a/i/airthings-wave-plus-hero-image-for-e-commerce-front.jpg" style="width: 40%; margin: 10px;" alt="Airthings Wave Plus" align="left"></p>
<p>This little gadget supports Bluetooth Low Energy (BLE), and therefore, doesn't really need
internet access. In fact, Airthings seems to know their audience, since they support some Python
scripts in <a href="https://github.com/Airthings/waveplus-reader">their GitHub repository</a>. Their
documentation for using the scripts is nice and simple, too. Pretty straight-forward to get
up-and-running if you've got Python 2.</p>
<p>That's right. I said <em>Python 2</em>. Unfortunately, although there's a
<a href="https://github.com/Airthings/waveplus-reader/pull/8">pull request</a> open to add Python 3 support,
it hasn't been resolved yet.</p>
<p>No matter!</p>
<p>I've taken the liberty of snagging the updated Python 3 content where that PR originates from, and
it certainly "checks out."</p>
<h2>Incorporating Into Home Assistant</h2>
<p>To go over the background, quickly:</p>
<p>My Home Assistant is being served from a Docker container on an old Compaq computer.</p>
<p><img src="https://blog.stanleysolutionsnw.com/images/2022-12-24_11-46.png" style="width: 60%; margin: 10px;" alt="My Old Compaq Computer" align="right"></p>
<p>It's a 32-bit monster running Debian 11. Slow as heck, but it plugs along alright. I recently
rebuilt the OS from the ground up to take advantage of a second hard-drive in the machine which,
frankly, I'd forgotten about until recently. That's meant that I can shove the whole config back
into a single repository in my GitLab server. Quite nice, if you ask me.</p>
<p>I digress.</p>
<p>The server is WAY too old to support Bluetooth in its existing hardware. But that's what USB is for, right? So I hooked up a little USB dongle which provides BLE support. Now, I just needed to pass it all through to Home Assistant.</p>
<p>I'll go through the steps I took, next, but I want to tell you; this isn't <em>exactly</em> the order
that I used initially. Would you expect me to have been that smart? To have put it together
correctly on the first pass?</p>
<p><strong><em>As if!</em></strong></p>
<h3>Installing the System Requirements</h3>
<p>So, really, the only package that I <em>needed</em> was <code>bluez</code>, but for some of the Airthings scripts,
there were a few others, so I'll list them all here...</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>bluez<span class="w"> </span>libglib2.0-dev<span class="w"> </span>-y
</code></pre></div>

<p>To get the Airthings scripts running, I also needed a few Python packages. They were installed
with:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>bluepy<span class="w"> </span>tableprint
</code></pre></div>

<p>Again... not entirely necessary, but could be useful if you're like me, and like debugging.</p>
<h3>Preparing the System</h3>
<p>With <code>bluez</code> installed, I could now turn on the Bluetooth system. I'm not entirely sure whether
this is necessary for Home Assistant's purposes, but it's useful from the Airthings script
point-of-view.</p>
<h5>Turn on Bluetooth!</h5>
<div class="highlight"><pre><span></span><code>joestan@hasio:~$<span class="w"> </span>sudo<span class="w"> </span>bluetoothctl
<span class="o">[</span>bluetooth<span class="o">]</span><span class="c1"># power on</span>
<span class="o">[</span>bluetooth<span class="o">]</span><span class="c1"># quit</span>
joestan@hasio:~$
</code></pre></div>

<h5>Set Bluetooth Dongle to Specific Device Alias</h5>
<p>Again, not totally sure if this was necesssary, but even if it wasn't, I like the outcome of
having a specifically named USB device show up. Makes things nice!</p>
<p>Listing my USB devices with <code>lsusb</code>, I was able to determine the appropriate device:</p>
<div class="highlight"><pre><span></span><code>joestan@hasio:~$<span class="w"> </span>lsusb
Bus<span class="w"> </span><span class="m">001</span><span class="w"> </span>Device<span class="w"> </span><span class="m">002</span>:<span class="w"> </span>ID<span class="w"> </span>1a40:0101<span class="w"> </span>Terminus<span class="w"> </span>Technology<span class="w"> </span>Inc.<span class="w"> </span>Hub
Bus<span class="w"> </span><span class="m">001</span><span class="w"> </span>Device<span class="w"> </span><span class="m">001</span>:<span class="w"> </span>ID<span class="w"> </span>1d6b:0002<span class="w"> </span>Linux<span class="w"> </span>Foundation<span class="w"> </span><span class="m">2</span>.0<span class="w"> </span>root<span class="w"> </span>hub
Bus<span class="w"> </span><span class="m">003</span><span class="w"> </span>Device<span class="w"> </span><span class="m">002</span>:<span class="w"> </span>ID<span class="w"> </span>0a5c:21e8<span class="w"> </span>Broadcom<span class="w"> </span>Corp.<span class="w"> </span>BCM20702A0<span class="w"> </span>Bluetooth<span class="w"> </span><span class="m">4</span>.0
Bus<span class="w"> </span><span class="m">003</span><span class="w"> </span>Device<span class="w"> </span><span class="m">001</span>:<span class="w"> </span>ID<span class="w"> </span>1d6b:0001<span class="w"> </span>Linux<span class="w"> </span>Foundation<span class="w"> </span><span class="m">1</span>.1<span class="w"> </span>root<span class="w"> </span>hub
Bus<span class="w"> </span><span class="m">002</span><span class="w"> </span>Device<span class="w"> </span><span class="m">001</span>:<span class="w"> </span>ID<span class="w"> </span>1d6b:0001<span class="w"> </span>Linux<span class="w"> </span>Foundation<span class="w"> </span><span class="m">1</span>.1<span class="w"> </span>root<span class="w"> </span>hub
</code></pre></div>

<p>I needed to edit my udev-rules and add a custom alias.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/udev/rules.d/99-my_rules.rules
</code></pre></div>

<p>And then, since it's pretty clear that Bus 3 Device 2 is the one I'm looking for, I could update
my udev file accordingly:</p>
<div class="highlight"><pre><span></span><code>ACTION==&quot;add&quot;, ATTRS{idVendor}==&quot;0a5c&quot;, ATTRS{idProduct}==&quot;21e8&quot;, SYMLINK+=&quot;btooth&quot;
</code></pre></div>

<p>Now, after a restart, I've got that device listed properly when I <code>ls /dev</code>:</p>
<div class="highlight"><pre><span></span><code>joestan@hasio:~$<span class="w"> </span>ls<span class="w"> </span>/dev
agpgart<span class="w">          </span>mqueue<span class="w">    </span>stderr<span class="w">  </span>tty29<span class="w">  </span>tty52<span class="w">    </span>vcs3
autofs<span class="w">           </span>net<span class="w">       </span>stdin<span class="w">   </span>tty3<span class="w">   </span>tty53<span class="w">    </span>vcs4
block<span class="w">            </span>null<span class="w">      </span>stdout<span class="w">  </span>tty30<span class="w">  </span>tty54<span class="w">    </span>vcs5
bsg<span class="w">              </span>nvram<span class="w">     </span>tty<span class="w">     </span>tty31<span class="w">  </span>tty55<span class="w">    </span>vcs6
btooth<span class="w">           </span>parport0<span class="w">  </span>tty0<span class="w">    </span>tty32<span class="w">  </span>tty56<span class="w">    </span>vcsa<span class="w">        </span><span class="c1">#&lt;--- Look!</span>
btrfs-control<span class="w">    </span>port<span class="w">      </span>tty1<span class="w">    </span>tty33<span class="w">  </span>tty57<span class="w">    </span>vcsa1
bus<span class="w">              </span>ppp<span class="w">       </span>tty10<span class="w">   </span>tty34<span class="w">  </span>tty58<span class="w">    </span>vcsa2
char<span class="w">             </span>psaux<span class="w">     </span>tty11<span class="w">   </span>tty35<span class="w">  </span>tty59<span class="w">    </span>vcsa3
console<span class="w">          </span>ptmx<span class="w">      </span>tty12<span class="w">   </span>tty36<span class="w">  </span>tty6<span class="w">     </span>vcsa4
core<span class="w">             </span>pts<span class="w">       </span>tty13<span class="w">   </span>tty37<span class="w">  </span>tty60<span class="w">    </span>vcsa5
cpu_dma_latency<span class="w">  </span>random<span class="w">    </span>tty14<span class="w">   </span>tty38<span class="w">  </span>tty61<span class="w">    </span>vcsa6
cuse<span class="w">             </span>rfkill<span class="w">    </span>tty15<span class="w">   </span>tty39<span class="w">  </span>tty62<span class="w">    </span>vcsu
disk<span class="w">             </span>rtc<span class="w">       </span>tty16<span class="w">   </span>tty4<span class="w">   </span>tty63<span class="w">    </span>vcsu1
fd<span class="w">               </span>rtc0<span class="w">      </span>tty17<span class="w">   </span>tty40<span class="w">  </span>tty7<span class="w">     </span>vcsu2
full<span class="w">             </span>sda<span class="w">       </span>tty18<span class="w">   </span>tty41<span class="w">  </span>tty8<span class="w">     </span>vcsu3
fuse<span class="w">             </span>sda1<span class="w">      </span>tty19<span class="w">   </span>tty42<span class="w">  </span>tty9<span class="w">     </span>vcsu4
hpet<span class="w">             </span>sda2<span class="w">      </span>tty2<span class="w">    </span>tty43<span class="w">  </span>ttyS0<span class="w">    </span>vcsu5
hugepages<span class="w">        </span>sdb<span class="w">       </span>tty20<span class="w">   </span>tty44<span class="w">  </span>ttyS1<span class="w">    </span>vcsu6
hwrng<span class="w">            </span>sdb1<span class="w">      </span>tty21<span class="w">   </span>tty45<span class="w">  </span>ttyS2<span class="w">    </span>vfio
initctl<span class="w">          </span>sdb2<span class="w">      </span>tty22<span class="w">   </span>tty46<span class="w">  </span>ttyS3<span class="w">    </span>vga_arbiter
input<span class="w">            </span>sdb3<span class="w">      </span>tty23<span class="w">   </span>tty47<span class="w">  </span>uhid<span class="w">     </span>vhci
kmsg<span class="w">             </span>sg0<span class="w">       </span>tty24<span class="w">   </span>tty48<span class="w">  </span>uinput<span class="w">   </span>vhost-net
log<span class="w">              </span>sg1<span class="w">       </span>tty25<span class="w">   </span>tty49<span class="w">  </span>urandom<span class="w">  </span>vhost-vsock
loop-control<span class="w">     </span>shm<span class="w">       </span>tty26<span class="w">   </span>tty5<span class="w">   </span>vcs<span class="w">      </span>watchdog
mapper<span class="w">           </span>snapshot<span class="w">  </span>tty27<span class="w">   </span>tty50<span class="w">  </span>vcs1<span class="w">     </span>watchdog0
mem<span class="w">              </span>snd<span class="w">       </span>tty28<span class="w">   </span>tty51<span class="w">  </span>vcs2<span class="w">     </span>zero
</code></pre></div>

<h5>Update Docker Container Command</h5>
<p>I'm lazy.</p>
<p>Although I haven't converted this machine to use <code>docker-compose</code>, I use a shell script to do
the heavy lifting for me, and get the latest container, update and redeploy it. So, when it came
time to update the command and make sure that I pass the Bluetooth device and <code>dbus</code> into the
container, it was pretty simple, just needed to add the arguments to the command...</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Start HassIO</span>
<span class="nb">echo</span><span class="w"> </span>Starting<span class="w"> </span>Hasio
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>homeassistant<span class="w"> </span>--restart<span class="o">=</span>unless-stopped<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="w"> </span>/home/joestan/stanleyassistant/homeassistant:/config<span class="w"> </span>-v<span class="w"> </span>/etc/localtime:/etc/localtime:ro<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="w"> </span>/run/dbus:/run/dbus:ro<span class="w"> </span>--privileged<span class="w"> </span>--network<span class="o">=</span>host<span class="w"> </span>--device<span class="w"> </span>/dev/btooth<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>ghcr.io/home-assistant/home-assistant:stable
</code></pre></div>

<p>Notice on the second line from the bottom, I'm using the following commands:</p>
<ul>
<li><code>-v /run/dbus:/run/dbus:ro</code>: This maps the <code>dbus</code> volume into the container appropriately.</li>
<li><code>--device /dev/btooth</code>: For good measure, this maps the Bluetooth device into the container.</li>
</ul>
<p>Those were really the only additions that were needed. Then it was just a matter of restarting
the container with the new arguments, and adding the config of the device in the HA Web-UI.</p>
<h2>Closing Thoughts</h2>
<p>Well, I think I learned a few things with this experience. Nothing terrible, or drastic. Just
some good points and things to remember. Kind of a nice accomplishment on a Christmas Eve, if you
ask me!</p>
<p>I love the tight integrations that can be offered with Home Assistant, and I'm really pleased with
my Airthings Wave Plus sensor. I love the fact that I can use it in my local system and start
monitoring for "bad gas."</p>
<p>Let me know if you have any thoughts or other experiences!</p>
      </div>
    </article>
  </main>
<!-- <script data-isso="https://blogcomments.stanleysolutionsnw.com/" src="https://blogcomments.stanleysolutionsnw.com/js/embed.min.js"></script>
<section class="comments" id="comments">
    <h3 class="panel">Comments</h3>
        <section id="isso-thread"></section> -->
<script src="https://giscus.app/client.js"
        data-repo="engineerjoe440/stanley-solutions-blog"
        data-repo-id="MDEwOlJlcG9zaXRvcnkyODk0MDQ2ODE="
        data-category="Comments"
        data-category-id="DIC_kwDOET_3Cc4CTonj"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="dark"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
</section>    </div>
  </div>

  <script>
    stork.register("sitesearch", "https://blog.stanleysolutionsnw.com/search-index.st");
  </script>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
      <li class="list-inline-item"><a href="https://blog.stanleysolutionsnw.com/authors.html">Authors</a></li>
    <li class="list-inline-item"><a href="https://blog.stanleysolutionsnw.com/archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="https://blog.stanleysolutionsnw.com/categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="https://blog.stanleysolutionsnw.com/tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>

</body>

</html>